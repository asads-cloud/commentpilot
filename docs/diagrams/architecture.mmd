%% CommentPilot Architecture (Phase 0â†’MVP)
flowchart LR
    subgraph Client["Frontend (Next.js)"]
      U["User"];
    end

    subgraph Auth["Cognito"]
      Cg[(User Pool)];
    end

    subgraph API["API Layer"]
      APIGW["API Gateway"];
      L1[(Lambda: REST handlers)];
    end

    subgraph DataLake["S3 Buckets"]
      S3R["raw/instagram, raw/tiktok"];
      S3P["processed/"];
    end

    subgraph ETL["ETL and Enrichment"]
      Glue["Glue Job(s)"];
      Comp["Comprehend"];
      Rules["Intent Rules"];
    end

    subgraph Storage["Data Stores"]
      Dyn["Dyn. Tables: messages, tenants"];
    end

    subgraph Sched["Scheduling and Alerts"]
      EVB["EventBridge"];
      SNS["SNS"];
      SES["SES"];
      Slack["Slack Webhook"];
    end

    subgraph CDN["Static Hosting"]
      CF["CloudFront"];
      S3Web[(S3 Website/Amplify)];
    end

    U -->|PKCE| Cg
    U -->|HTTPS| CF --> S3Web
    U -->|HTTPS| APIGW --> L1
    EVB --> L1
    L1 --> S3R
    Glue --> S3P
    Glue --> Dyn
    L1 -->|invoke| Comp --> L1
    L1 --> Rules --> Dyn
    L1 --> SNS --> SES
    SNS --> Slack
